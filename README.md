# MovieDbFirst
This is the example solution walked trhough during the October 14, 2021 Code Louisville session showing database first Entity Framework Core and Azure Functions.

The solution consists of the following projects:

* **[Database](#databse)**: A SQL Sever Data Tools (SSDT) project containing the T-SQL used to generate the Movies database.
* **[Repository](#repository)**: A class library containing the Entity Framework Core repository consisting of the entities and the context.
* **[FunctionApp](#functionapp)**: The Azure Functions app providing a REST API for retriving and manipulating movies within the database.

Below are more details about the project and how to use them.

---

### Database
SQL Server Data Tools (SSDT) transforms database development by introducing a ubiquitous, declarative model that spans all the phases of database development inside Visual Studio. You can use SSDT Transact-SQL design capabilities to build, debug, maintain, and refactor databases. You can work with a database project, or directly with a connected database instance on or off-premise.

The project contains the following files of importance to this project:

* \Tables\Movie.sql — Builds the Movie table with the following columns: MovieId, Title, and ReleaseDate.
* \Scripts\Populate_Movie.sql — Script that populates the Movie database with an initial set of movies (the complete James Bond anthology).
* \Scripts\Script.PostDeployment.sql — When you publish to a database from SSDT, the publish process will run this script at the end of deployment.  In this script, it references the Populate_Movie.sql script in order to popualte that table.

To use this project, make changes to the scripts or add as needed.  When ready to publish, right click on the project and then select *Publish*.

---

### Repository
The Repository project contains the Entity Framework Core logic generated by scaffolding tools.  This allows you base application on existing databases.  To build this project, you can run the following from the Package Manager Console (available by going to *Tools / NuGet Package Manager / Package Manager Console*):

~~~

Scaffold-DbContext 'Data Source=(localdb)\mssqllocaldb;Initial Catalog=Movies' Microsoft.EntityFrameworkCore.SqlServer -Force

~~~

The '-Force' switch will overwrite the existing classes.

---

### FunctionApp

The Azure Functions project running the REST endpoints.  There are two files to look at for right now:

* **Program.cs** — Here we are setting up dependency injection so that we have the JSON serializing options.  There isn't actually that much value in this project for this.  But as this project grows this will reduce the number of times we need to generate that code.
* **MovieApi.cs** — Here are the 5 Azure Functions to provide CRUD (**C**reate, **R**ead, **U**pdate, **D**elete) capabilities for the Movie table.  This has been cleaned up a bit from what we did during class; but it is missing validations that are pretty important - in future updates, I'll improve these.